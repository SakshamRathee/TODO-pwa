<!DOCTYPE html>
<html lang="en">

<head>
         <meta charset="UTF-8" />
         <meta name="viewport" content="width=device-width, initial-scale=1.0" />
         <title>My To-Do List</title>
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
         <link rel="manifest" href="manifest.json" />
         <meta name="theme-color" content="#212529" />
         <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />

         <style>
                  body {
                           transition: all 0.3s ease;
                           display: flex;
                           justify-content: center;
                           align-items: center;
                           min-height: 100vh;
                  }

                  .todo-card {
                           width: 380px;
                           border-radius: 12px;
                           box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                           transition: all 0.3s ease;
                  }

                  li.completed span {
                           text-decoration: line-through;
                           color: gray;
                           opacity: 0.7;
                  }

                  span {
                           cursor: pointer;
                           flex: 1;
                  }

                  body.dark {
                           background-color: #121212;
                           color: #f8f9fa;
                  }

                  body.dark .todo-card {
                           background-color: #1e1e1e;
                           color: white;
                  }

                  body.dark .list-group-item {
                           background-color: #2c2c2c;
                           color: #fff;
                           border-color: #3c3c3c;
                  }

                  .mode-toggle {
                           position: absolute;
                           top: 20px;
                           right: 20px;
                  }
         </style>
</head>

<body>
         <div class="form-check form-switch mode-toggle">
                  <input class="form-check-input" type="checkbox" id="modeSwitch" onchange="toggleMode()">
                  <label class="form-check-label fw-semibold" for="modeSwitch">üåô</label>
         </div>

         <div class="card todo-card">
                  <div class="card-body">
                           <h4 class="card-title text-center mb-4 fw-bold">My To-Do List</h4>
                           <div class="input-group mb-3">
                                    <input type="text" id="taskInput" class="form-control"
                                             placeholder="Add a new task..." />
                                    <button class="btn btn-dark" onclick="addTask()">Add</button>
                           </div>
                           <ul class="list-group" id="taskList"></ul>
                           <div class="text-center mt-3">
                                    <button class="btn btn-outline-danger btn-sm" onclick="clearAll()">Clear
                                             All</button>
                           </div>
                  </div>
         </div>

         <script>
                  // Load tasks and theme
                  window.onload = function () {
                           const savedTasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           savedTasks.forEach(t => renderTask(t.text, t.completed));

                           const savedTheme = localStorage.getItem("theme") || "light";
                           if (savedTheme === "dark") {
                                    document.body.classList.add("dark");
                                    document.getElementById("modeSwitch").checked = true;
                                    document.querySelector("label[for='modeSwitch']").textContent = "‚òÄÔ∏è";
                           }
                  };

                  function addTask() {
                           const input = document.getElementById("taskInput");
                           const val = input.value.trim();
                           if (!val) return alert("Please enter a task!");
                           renderTask(val, false);
                           saveTask(val, false);
                           input.value = "";
                  }

                  function renderTask(text, done) {
                           const li = document.createElement("li");
                           li.className = "list-group-item d-flex justify-content-between align-items-center";
                           if (done) li.classList.add("completed");
                           li.innerHTML = `<span onclick="toggleComplete(this)" class="me-3">${text}</span>
                      <button class="btn btn-sm btn-danger" onclick="deleteTask(this)">Delete</button>`;
                           document.getElementById("taskList").appendChild(li);
                  }

                  function saveTask(text, done) {
                           const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks.push({ text, completed: done });
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  function deleteTask(btn) {
                           const text = btn.parentElement.querySelector("span").textContent;
                           btn.parentElement.remove();
                           let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks = tasks.filter(t => t.text !== text);
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  function toggleComplete(span) {
                           const li = span.parentElement;
                           li.classList.toggle("completed");
                           const text = span.textContent;
                           let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks = tasks.map(t => t.text === text ? { ...t, completed: !t.completed } : t);
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  function clearAll() {
                           if (confirm("Clear all tasks?")) {
                                    document.getElementById("taskList").innerHTML = "";
                                    localStorage.removeItem("tasks");
                           }
                  }

                  function toggleMode() {
                           const dark = document.body.classList.toggle("dark");
                           localStorage.setItem("theme", dark ? "dark" : "light");
                           document.querySelector("label[for='modeSwitch']").textContent = dark ? "‚òÄÔ∏è" : "üåô";
                  }

                  // Register Service Worker
                  if ("serviceWorker" in navigator) {
                           navigator.serviceWorker.register("service-worker.js");
                  }
         </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
         <meta charset="UTF-8" />
         <meta name="viewport" content="width=device-width, initial-scale=1.0" />
         <title>My To-Do List</title>
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
         <link rel="manifest" href="manifest.json" />
         <meta name="theme-color" content="#212529" />
         <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />

         <style>
                  body {
                           transition: all 0.3s ease;
                           display: flex;
                           justify-content: center;
                           align-items: center;
                           min-height: 100vh;
                  }

                  .todo-card {
                           width: 380px;
                           border-radius: 12px;
                           box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                           transition: all 0.3s ease;
                  }

                  li.completed span {
                           text-decoration: line-through;
                           color: gray;
                           opacity: 0.7;
                  }

                  span {
                           cursor: pointer;
                           flex: 1;
                  }

                  body.dark {
                           background-color: #121212;
                           color: #f8f9fa;
                  }

                  body.dark .todo-card {
                           background-color: #1e1e1e;
                           color: white;
                  }

                  body.dark .list-group-item {
                           background-color: #2c2c2c;
                           color: #fff;
                           border-color: #3c3c3c;
                  }

                  .mode-toggle {
                           position: absolute;
                           top: 20px;
                           right: 20px;
                  }
         </style>
</head>

<body>
         <div class="form-check form-switch mode-toggle">
                  <input class="form-check-input" type="checkbox" id="modeSwitch" onchange="toggleMode()">
                  <label class="form-check-label fw-semibold" for="modeSwitch">üåô</label>
         </div>

         <div class="card todo-card">
                  <div class="card-body">
                           <h4 class="card-title text-center mb-4 fw-bold">My To-Do List</h4>
                           <div class="input-group mb-3">
                                    <input type="text" id="taskInput" class="form-control"
                                             placeholder="Add a new task..." />
                                    <button class="btn btn-dark" onclick="addTask()">Add</button>
                           </div>
                           <ul class="list-group" id="taskList"></ul>
                           <div class="text-center mt-3">
                                    <button class="btn btn-outline-danger btn-sm" onclick="clearAll()">Clear
                                             All</button>
                           </div>
                  </div>
         </div>

         <script>
                  // Load tasks & theme
                  window.onload = function () {
                           const savedTasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           savedTasks.forEach(t => renderTask(t.text, t.completed, t.reminderTime));

                           const savedTheme = localStorage.getItem("theme") || "light";
                           if (savedTheme === "dark") {
                                    document.body.classList.add("dark");
                                    document.getElementById("modeSwitch").checked = true;
                                    document.querySelector("label[for='modeSwitch']").textContent = "‚òÄÔ∏è";
                           }

                           // Register Service Worker
                           if ("serviceWorker" in navigator) {
                                    navigator.serviceWorker.register("service-worker.js");
                           }
                  };

                  // Add new task
                  function addTask() {
                           const input = document.getElementById("taskInput");
                           const val = input.value.trim();
                           if (!val) return alert("Please enter a task!");
                           renderTask(val, false);
                           saveTask(val, false, null);
                           input.value = "";
                  }

                  // Render each task
                  function renderTask(text, done, reminderTime) {
                           const li = document.createElement("li");
                           li.className = "list-group-item d-flex justify-content-between align-items-center";
                           if (done) li.classList.add("completed");

                           li.innerHTML = `
      <div class="d-flex align-items-center" style="gap: 8px;">
        <span onclick="toggleComplete(this)" class="me-2">${text}</span>
        <input type="datetime-local" class="form-control form-control-sm reminder-input" style="width:160px" value="${reminderTime || ''}" onchange="setReminder(this)">
      </div>
      <div>
        <button class="btn btn-sm btn-danger" onclick="deleteTask(this)">Delete</button>
      </div>
    `;
                           document.getElementById("taskList").appendChild(li);
                  }

                  // Save task
                  function saveTask(text, done, reminderTime) {
                           const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks.push({ text, completed: done, reminderTime });
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  // Delete task
                  function deleteTask(btn) {
                           const text = btn.parentElement.parentElement.querySelector("span").textContent;
                           btn.parentElement.parentElement.remove();
                           let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks = tasks.filter(t => t.text !== text);
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  // Toggle completion
                  function toggleComplete(span) {
                           const li = span.parentElement.parentElement;
                           li.classList.toggle("completed");
                           const text = span.textContent;
                           let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks = tasks.map(t => t.text === text ? { ...t, completed: !t.completed } : t);
                           localStorage.setItem("tasks", JSON.stringify(tasks));
                  }

                  // Clear all
                  function clearAll() {
                           if (confirm("Clear all tasks?")) {
                                    document.getElementById("taskList").innerHTML = "";
                                    localStorage.removeItem("tasks");
                           }
                  }

                  // Dark/Light Mode
                  function toggleMode() {
                           const dark = document.body.classList.toggle("dark");
                           localStorage.setItem("theme", dark ? "dark" : "light");
                           document.querySelector("label[for='modeSwitch']").textContent = dark ? "‚òÄÔ∏è" : "üåô";
                  }

                  // ===== Notification Feature =====
                  async function requestNotificationPermission() {
                           if (!("Notification" in window)) {
                                    alert("This browser does not support notifications.");
                                    return false;
                           }

                           let permission = Notification.permission;
                           if (permission === "granted") return true;
                           if (permission !== "denied") {
                                    permission = await Notification.requestPermission();
                           }
                           return permission === "granted";
                  }

                  async function setReminder(input) {
                           const li = input.closest("li");
                           const text = li.querySelector("span").textContent;
                           const time = input.value;

                           if (!time) return; // cleared reminder

                           const granted = await requestNotificationPermission();
                           if (!granted) {
                                    alert("Notifications are blocked. Please enable them in browser settings.");
                                    return;
                           }

                           const reminderTime = new Date(time).getTime();
                           const now = new Date().getTime();
                           const delay = reminderTime - now;

                           if (delay <= 0) {
                                    alert("Reminder time must be in the future.");
                                    return;
                           }

                           alert(`Reminder set for "${text}" at ${new Date(reminderTime).toLocaleString()}`);

                           // Save reminder in localStorage
                           let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                           tasks = tasks.map(t => t.text === text ? { ...t, reminderTime: time } : t);
                           localStorage.setItem("tasks", JSON.stringify(tasks));

                           // Schedule notification
                           setTimeout(() => {
                                    showNotification(text);
                           }, delay);
                  }

                  function showNotification(taskText) {
                           if (Notification.permission === "granted") {
                                    new Notification("Task Reminder ‚è∞", {
                                             body: `Don't forget: ${taskText}`,
                                             icon: "icon-192.png"
                                    });
                           }
                  }
         </script>

</body>

</html>